<!doctype html>
<!-- See http://www.firepad.io/docs/ for detailed embedding docs. -->
<html>

<head>
  <meta charset="utf-8" />

  <!-- CodeMirror -->
  <script src="assets/codemirror.js"></script>
  <link rel="stylesheet" href="assets/codemirror.css" />

  <!-- Firepad -->
  <link rel="stylesheet" href="assets/firepad.css" />
  <script src="../dist/firepad.js"></script>
  <script src="assets/jquery-3.1.1.min.js"></script>

 
  <style>
    html { height: 100%; }
    body { margin: 0; height: 100%; position: relative; }
      /* Height / width / positioning can be customized for your use case.
         For demo purposes, we make firepad fill the entire browser. */
    #firepad-container {
      width: 100%;
      height: 100%;
    }
  </style>

</head>


<body onload="">
<!-- <div class="status"></div> -->
  <div id="firepad-container"></div>

  <script>
  var escape_str = function addslashes( str ) {
    return (str + '').replace(/[\\"']/g, '\\$&').replace(/\u0000/g, '\\0');
  }
  
  var firepad;
  var code_mirror;
    (init = function init() {
      //// Create CodeMirror (with lineWrapping on).
      code_mirror = CodeMirror(document.getElementById('firepad-container'), { lineWrapping: true });

      //// Create Firepad (with rich text toolbar and shortcuts enabled).
      firepad = Firepad.fromCodeMirror(code_mirror,
                                      { richTextToolbar: true, richTextShortcuts: true });


      //// Autosave notes
      var timeout_id;
      var status = $('div.status');

      code_mirror.on('keypress', function(){

        status.text("changes pending");
        if (timeout_id) {
          clearTimeout(timeout_id);
        }
        timeout_id = setTimeout(function() {
          console.error("note_text$" + firepad.getHtml());
          status.text("changes saved");
        }, 720);

      })
    })();


    $.fn.lastHandler = function(events,handler) {
      var element = $(this);
      events = events.split(' ');
      for (var evt in events) {
          var event = $(element).data("events")[events[evt]];
          var hsucess = null;
          $.each(event, function (i, h) {
              if (h.handler == handler) {
                  hsucess = h;
              }
          });
          var index = event.indexOf(hsucess);
          if (index > -1) {
              event.splice(index, 1);
              event.push(hsucess);
          }
      }
  };

    onClickHandler = function() {
      console.error("note_text$" + firepad.getHtml());
    };
    
    $(".firepad-btn").click(onClickHandler);

    $(".firepad-btn").lastHandler(onClickHandler);

    function GradientManager() {
      var self = {};
      var body = $("body");

      self.gradients = [
        {"gradient": "linear-gradient(to top, #dfe9f3 0%, white 100%)", 
        "hover_color": "#ccc"
        }
      ]

      self.mappings = ['blue'];

      self.showMappings = function() {
        console.log(self.mappings);
      }

      self.changeBackground = function(gradient) {
        $("body").css("background-image", '"'+gradient+'"');
      }

      self.changeGradient = function(index) {
        var gradient = self.gradients[index]['gradient'];
        console.warn(gradient);
        self.changeBackground(gradient);
        
      }

      return self;

    }


  </script>
</body>
</html>
